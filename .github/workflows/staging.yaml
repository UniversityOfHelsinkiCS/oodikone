name: 'Test and release to staging'

on:
  push:
    branches:
      - master
      - tsMerge
    paths:
      - '.github/workflows/test.yaml'
      - '.github/workflows/staging.yaml'
      - '.github/actions/**'
      - 'cypress/**'
      - 'cypress.config.json'
      - 'services/**'
      - '!services/backend/src/rapodiff/**'
      - 'docker-compose.ci.yml'
      - 'package*.json'
      - 'updater/sis-updater-worker/src/db/migrations/**'

jobs:
  test:
    uses: ./.github/workflows/test.yaml
    secrets:
      username: ${{ secrets.TOSKAREGISTRY_USERNAME }}
      password: ${{ secrets.TOSKAREGISTRY_PASSWORD }}
