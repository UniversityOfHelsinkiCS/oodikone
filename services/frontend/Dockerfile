FROM registry.access.redhat.com/ubi9/nodejs-22-minimal

ENV TZ="Europe/Helsinki"

ENV NODE_ENV=production

WORKDIR /opt/app-root/shared
COPY ./shared .

WORKDIR /opt/app-root/frontend

ARG BASE_PATH
ENV PUBLIC_URL=$BASE_PATH

ARG BUILT_AT
ENV REACT_APP_BUILT_AT=$BUILT_AT

ARG STAGING
ENV REACT_APP_STAGING=$STAGING

ARG SENTRY_ENVIRONMENT
ENV REACT_APP_SENTRY_ENVIRONMENT=$SENTRY_ENVIRONMENT

ARG SENTRY_RELEASE
ENV REACT_APP_SENTRY_RELEASE=$SENTRY_RELEASE

ARG SENTRY_DSN
ENV REACT_APP_SENTRY_DSN=$SENTRY_DSN

ARG SERVICE_PROVIDER
ENV REACT_APP_SERVICE_PROVIDER=$SERVICE_PROVIDER

ARG LANGUAGE_CENTER_VIEW_ENABLED
ENV REACT_APP_LANGUAGE_CENTER_VIEW_ENABLED=$LANGUAGE_CENTER_VIEW_ENABLED

ARG SIS_URL
ENV REACT_APP_SIS_URL=$SIS_URL

COPY ./frontend/package* .
RUN npm ci --include=dev
COPY ./frontend .

RUN npm run build && npm install -g serve@12.0.0

EXPOSE 5000
CMD ["serve", "--single", "--listen", "5000", "build"]
