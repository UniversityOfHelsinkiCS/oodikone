version: '3.2'

services:
  updater_api:
    build:
      args:
        NODE_ENV: 'development'
    command: ['sh', '-c', 'cp -r /usr/src/cache/node_modules/. /usr/src/app/node_modules/ && npm run dev']
    volumes:
      - ./updater/updater_api/:/usr/src/app
    restart: unless-stopped

  updater_writer:
    build:
      args:
        NODE_ENV: 'development'
    command: ['sh', '-c', 'cp -r /usr/src/cache/node_modules/. /usr/src/app/node_modules/ && npm run dev']
    volumes:
      - ./services/backend/updater_writer/:/usr/src/app
      - ./services/backend/shared/models:/usr/src/app/models
      - ./services/backend/shared/migrations:/usr/src/app/database/migrations
      - ./services/backend/shared/migrations_kone:/usr/src/app/database/migrations_kone
    environment:
      DB_SCHEMA_KONE: kone_data
    restart: unless-stopped

  updater_scheduler:
    build:
      args:
        NODE_ENV: 'development'
    command: ['sh', '-c', 'cp -r /usr/src/cache/node_modules/. /usr/src/app/node_modules/ && npm run dev']
    volumes:
      - ./updater/updater_scheduler/:/usr/src/app
    restart: unless-stopped

  sis-updater-scheduler:
    build:
      args:
        NODE_ENV: 'development'
    command: ['sh', '-c', 'cp -r /usr/src/cache/node_modules/. /usr/src/app/node_modules/ && npm run dev']
    volumes:
      - ./updater/sis-updater-scheduler/:/usr/src/app
    restart: unless-stopped

  sis-updater-worker:
    build:
      args:
        NODE_ENV: 'development'
    command: 'npm run dev'
    volumes:
      - ./updater/sis-updater-worker/:/usr/src/app
    restart: unless-stopped
